## Azure Machine Learning 작업 영역 살펴보기

Azure Machine Learning은 기계 학습 모델을 학습하고 관리하기 위한 데이터 과학 플랫폼을 제공합니다. 이 실습에서는 Azure Machine Learning 작업 영역을 만들고 작업 영역과 함께 작업하는 다양한 방법을 살펴봅니다. 이 실습은 Azure Machine Learning의 다양한 핵심 기능과 개발자 도구를 소개하기 위해 설계되었습니다. 기능에 대해 더 자세히 알고 싶다면 다른 실습을 통해 탐색할 수 있습니다.

**실습 목표:**

*   Azure Portal을 사용하여 Azure Machine Learning 작업 영역 프로비저닝하기
*   Azure Machine Learning 스튜디오의 주요 구성 요소 이해하기
*   자동화된 ML(AutoML)을 사용하여 분류 모델 학습시키기
*   학습 작업(Job) 기록 검토하기

**준비물:**

*   관리자 수준 액세스 권한이 있는 Azure 구독

---

### Azure Machine Learning 작업 영역 프로비저닝

Azure Machine Learning 작업 영역은 모델을 학습하고 관리하는 데 필요한 모든 리소스와 자산을 관리하기 위한 중앙 집중식 공간을 제공합니다. Azure Portal의 대화형 인터페이스를 사용하거나 Azure Machine Learning 확장이 포함된 Azure CLI를 사용하여 작업 영역을 프로비저닝할 수 있습니다. 대부분의 프로덕션 시나리오에서는 리소스 배포를 반복 가능한 개발 및 운영(DevOps) 프로세스에 통합할 수 있도록 CLI를 사용하여 프로비저닝을 자동화하는 것이 가장 좋습니다.

이 연습에서는 모든 옵션을 탐색하기 위해 Azure Portal을 사용하여 Azure Machine Learning을 프로비저닝합니다.

1.  [https://portal.azure.com/](https://portal.azure.com/)에 로그인합니다.
2.  다음 설정을 사용하여 새 Azure Machine Learning 리소스를 만듭니다.
    *   **구독**: 사용자의 Azure 구독
    *   **리소스 그룹**: `rg-dp100-labs` (새로 만들기를 선택하고 이 이름을 입력합니다.)
    *   **작업 영역 이름**: `mlw-dp100-labs`
    *   **지역**: 가장 가까운 지리적 지역을 선택합니다 (예: Korea Central).
    *   **저장소 계정**: 작업 영역에 대해 생성될 기본 새 저장소 계정을 확인합니다. (Azure ML은 학습 데이터, 모델, 스크립트 등을 저장하기 위해 이 저장소 계정을 사용합니다.)
    *   **키 자격 증명 모음**: 작업 영역에 대해 생성될 기본 새 키 자격 증명 모음을 확인합니다. (Azure ML은 자격 증명, API 키 등 민감한 정보를 안전하게 저장하기 위해 이 키 자격 증명 모음을 사용합니다.)
    *   **Application Insights**: 작업 영역에 대해 생성될 기본 새 Application Insights 리소스를 확인합니다. (Azure ML은 모델 배포 후 모니터링 및 로깅, 실험 실행 중 발생하는 문제 진단 등에 이 Application Insights를 사용합니다.)
    *   **컨테이너 레지스트리**: 없음 (모델을 컨테이너에 처음 배포할 때 자동으로 생성됩니다.)
3.  작업 영역 및 관련 리소스가 생성될 때까지 기다립니다. 일반적으로 약 5분 정도 소요됩니다.

**참고**: Azure Machine Learning 작업 영역을 만들 때 프라이빗 엔드포인트를 통해 액세스를 제한하고 데이터 암호화를 위한 사용자 지정 키를 지정하는 등 몇 가지 고급 옵션을 사용할 수 있습니다. 이 연습에서는 이러한 옵션을 사용하지 않지만, 알고 있어야 합니다! (프라이빗 엔드포인트는 VNet 내에서만 접근하도록 보안을 강화하고, 사용자 지정 키는 저장된 데이터 암호화에 사용됩니다.)

---

### Azure Machine Learning 스튜디오 살펴보기

Azure Machine Learning 스튜디오는 Azure Machine Learning 작업 영역에 액세스할 수 있는 웹 기반 포털입니다. Azure Machine Learning 스튜디오를 사용하여 작업 영역 내의 모든 자산과 리소스를 관리할 수 있습니다.

1.  `rg-dp100-labs`라는 이름의 리소스 그룹으로 이동합니다.
2.  리소스 그룹에 Azure Machine Learning 작업 영역, Application Insights, Key Vault 및 Storage Account가 포함되어 있는지 확인합니다.
3.  Azure Machine Learning 작업 영역을 선택합니다.
4.  **개요(Overview)** 페이지에서 **스튜디오 시작(Launch studio)** 을 선택합니다. 브라우저에서 다른 탭이 열리면서 Azure Machine Learning 스튜디오가 열립니다.
5.  스튜디오에 나타나는 모든 팝업을 닫습니다.
6.  스튜디오 왼쪽에 표시된 다양한 페이지를 확인합니다. 메뉴에 기호만 표시되는 경우 **☰** 아이콘을 선택하여 메뉴를 확장하고 페이지 이름을 탐색합니다.
7.  **작성(Authoring)** 섹션을 확인합니다. 여기에는 **Notebooks**, **자동화된 ML(Automated ML)**, **디자이너(Designer)** 가 포함됩니다. 이들은 Azure Machine Learning 스튜디오 내에서 자체 기계 학습 모델을 만들 수 있는 세 가지 방법입니다.
    *   **Notebooks**: Jupyter Notebook 환경에서 Python 코드를 직접 작성하여 모델을 개발합니다.
    *   **자동화된 ML(Automated ML)**: 코딩 없이 UI를 통해 최적의 모델을 자동으로 찾고 학습시킵니다.
    *   **디자이너(Designer)**: 시각적인 드래그 앤 드롭 인터페이스로 파이프라인을 구성하여 모델을 학습합니다.
8.  **자산(Assets)** 섹션을 확인합니다. 여기에는 **데이터(Data)**, **작업(Jobs)**, **모델(Models)** 등이 포함됩니다. 자산은 모델을 학습하거나 스코어링할 때 소비되거나 생성됩니다. 자산은 모델을 학습, 배포 및 관리하는 데 사용되며, 기록을 추적하기 위해 버전 관리될 수 있습니다.
9.  **관리(Manage)** 섹션을 확인합니다. 여기에는 **컴퓨팅(Compute)** 등이 포함됩니다. 이들은 기계 학습 모델을 학습하거나 배포하는 데 필요한 인프라 리소스입니다.

---

### AutoML을 사용하여 모델 학습

Azure Machine Learning 작업 영역의 자산 및 리소스 사용을 탐색하기 위해 모델을 학습해 보겠습니다.

데이터를 기반으로 작업에 가장 적합한 모델을 신속하게 학습하고 찾는 방법은 AutoML 옵션을 사용하는 것입니다.

**참고**: 스튜디오를 안내하기 위해 팝업이 나타날 수 있습니다. 모든 팝업을 닫고 이 실습의 지침에 집중하십시오.

1.  [https://github.com/MicrosoftLearning/mslearn-azure-ml/raw/refs/heads/main/Labs/02/diabetes-data.zip](https://github.com/MicrosoftLearning/mslearn-azure-ml/raw/refs/heads/main/Labs/02/diabetes-data.zip)에서 사용할 학습 데이터를 다운로드하고 압축 파일을 추출합니다.
    *   **팁**: 다운로드 후 압축을 해제하여 `diabetes.csv` 파일이 포함된 폴더를 준비합니다.
2.  Azure Machine Learning 스튜디오로 돌아가서 스튜디오 왼쪽 메뉴에서 **자동화된 ML(Automated ML)** 페이지를 선택합니다.
3.  **+ 새 자동화된 ML 작업(+ New Automated ML job)** 을 선택합니다.
4.  **기본 설정(Basic settings)** 단계에서 학습 작업 및 실험에 고유한 이름을 지정하거나 할당된 기본값을 사용합니다. **다음(Next)** 을 선택합니다.
5.  **작업 유형 및 데이터(Task type & data)** 단계에서 작업 유형으로 **분류(Classification)** 를 선택하고, **+ 만들기(+ Create)** 를 선택하여 학습 데이터를 추가합니다.
6.  **데이터 자산 만들기(Create data asset)** 페이지의 **데이터 형식(Data type)** 단계에서 데이터 자산에 이름(예: `training-data`)을 지정하고 **다음(Next)** 을 선택합니다.
7.  **데이터 원본(Data source)** 단계에서 이전에 다운로드한 학습 데이터를 업로드하기 위해 **로컬 파일에서(From local files)** 를 선택합니다. **다음(Next)** 을 선택합니다.
8.  **대상 저장소 유형(Destination storage type)** 단계에서 데이터 저장소 유형으로 **Azure Blob Storage** 가 선택되어 있고 데이터 저장소로 **workspaceblobstore** 가 선택되어 있는지 확인합니다. **다음(Next)** 을 선택합니다.
9.  **MLTable 선택(MLTable selection)** 단계에서 **폴더 업로드(Upload folder)** 를 선택하고 이전에 다운로드한 압축 파일에서 추출한 폴더를 선택합니다. **다음(Next)** 을 선택합니다.
10. 데이터 자산 설정을 검토하고 **만들기(Create)** 를 선택합니다.
11. **작업 유형 및 데이터(Task type & data)** 단계로 돌아와서 방금 업로드한 데이터를 선택하고 **다음(Next)** 을 선택합니다.
    *   **팁**: 다음 단계로 넘어가기 전에 분류 작업 유형을 다시 선택해야 할 수 있습니다.
12. **작업 설정(Task settings)** 단계에서 대상 열로 **Diabetic (Boolean)** 을 선택한 다음, **추가 구성 설정 보기(View additional configuration settings)** 옵션을 엽니다.
13. **추가 구성(Additional configuration)** 창에서 **기본 메트릭(Primary metric)** 을 **정확도(Accuracy)** 로 변경한 다음 **저장(Save)** 을 선택합니다.
14. **제한(Limits)** 옵션을 확장하고 다음 속성을 설정합니다.
    *   **최대 평가판 수(Max trials)**: `10` (다양한 모델/하이퍼파라미터 조합 시도 횟수)
    *   **실험 시간 제한(분)(Experiment timeout (minutes))**: `60`
    *   **반복 시간 제한(분)(Iteration timeout (minutes))**: `15` (단일 모델 학습 시간 제한)
    *   **조기 종료 사용(Enable early termination)**: 선택됨 (개선 없을 시 자동 중단)
15. **테스트 데이터(Test data)** 에 대해 **학습-테스트 분할(Train-test split)** 을 선택하고 **테스트 데이터 비율(Percentage of test data)** 이 `10`인지 확인합니다. **다음(Next)** 을 선택합니다.
    *   **테스트 데이터의 의미**: 여기서는 **훈련-테스트 분할**을 사용하며, **테스트 데이터 비율**은 10%로 설정합니다. 이는 원본 데이터의 10%를 모델 성능 평가용으로 따로 분리한다는 의미입니다. 이 데이터는 모델이 학습 과정에서 보지 못한 데이터여야 정확한 성능 측정이 가능합니다. AutoML은 이 분할된 테스트 데이터셋을 사용하여 각 시도된 모델의 성능을 평가하고, 지정된 기본 메트릭(여기서는 정확도)을 기준으로 최적의 모델을 식별합니다.
16. **컴퓨팅(Compute)** 단계에서 컴퓨팅 유형이 **서버리스(Serverless)** 이고 선택된 가상 머신 크기가 **Standard_DS3_v2** 인지 확인합니다. **다음(Next)** 을 선택합니다.
    *   **참고**: 컴퓨팅 인스턴스 및 클러스터는 표준 Azure 가상 머신 이미지를 기반으로 합니다. 이 연습에서는 비용과 성능의 최적 균형을 위해 Standard\_DS3\_v2 이미지를 권장합니다. 구독에 이 이미지를 포함하지 않는 할당량이 있는 경우 대체 이미지를 선택하십시오. 단, 더 큰 이미지는 더 높은 비용이 발생할 수 있고 더 작은 이미지는 작업을 완료하기에 충분하지 않을 수 있습니다. 또는 Azure 관리자에게 할당량 확장을 요청하십시오.
17. 모든 설정을 검토하고 **학습 작업 제출(Submit training job)** 을 선택합니다.

---

### 기록을 보기 위해 작업(Jobs) 사용

작업을 제출하면 작업 페이지로 리디렉션됩니다. 작업(Job)을 사용하면 실행한 워크로드를 추적하고 서로 비교할 수 있습니다. 작업은 실험(Experiment)에 속하며, 실험을 통해 여러 작업 실행을 함께 그룹화할 수 있습니다.

*   **개요 매개변수(Overview parameters)** 에서 작업 상태, 생성자, 생성 시기, 실행 시간 등을 확인할 수 있습니다.
*   학습 작업이 완료되는 데 10~20분 정도 걸립니다. 완료되면 각 개별 구성 요소 실행의 세부 정보(출력 포함)도 볼 수 있습니다. 모델이 어떻게 학습되는지 이해하기 위해 작업 페이지를 자유롭게 탐색해 보십시오.

Azure Machine Learning은 작업 속성을 자동으로 추적합니다. 작업을 사용하면 기록을 쉽게 확인하여 사용자 또는 동료가 이미 수행한 작업을 이해할 수 있습니다. 실험 중에는 작업을 통해 학습한 여러 모델을 추적하여 비교하고 최상의 모델을 식별하는 데 도움이 됩니다. 프로덕션 환경에서는 작업을 통해 자동화된 워크로드가 예상대로 실행되었는지 확인할 수 있습니다.

---

### 실습 데이터 설명 (`diabetes-data.zip` 내 `diabetes.csv`)

이 실습에서 사용하는 `diabetes.csv` 데이터는 당뇨병 발병 여부를 예측하기 위한 데이터셋입니다. 각 행은 한 명의 환자를 나타내며, 다음과 같은 열(특성)을 포함합니다:

*   `PatientID`: 환자 고유 ID
*   `Pregnancies`: 임신 횟수
*   `PlasmaGlucose`: 경구 포도당 부하 검사에서 2시간 후 혈장 포도당 농도
*   `DiastolicBloodPressure`: 이완기 혈압 (mm Hg)
*   `TricepsThickness`: 삼두근 피부 주름 두께 (mm)
*   `SerumInsulin`: 2시간 혈청 인슐린 (mu U/ml)
*   `BMI`: 체질량 지수 (체중(kg)/(키(m))^2)
*   `DiabetesPedigree`: 당뇨병 가족력 함수
*   `Age`: 나이 (세)
*   `Diabetic`: 당뇨병 여부 (0 = 당뇨병 아님, 1 = 당뇨병) - **이것이 우리가 예측하려는 대상 변수(Target Column)입니다.**

**데이터셋의 목표**: 이 데이터셋의 목표는 여러 의학적 예측 변수를 기반으로 환자가 당뇨병을 앓고 있는지 (`Diabetic` 필드: 1) 아닌지 (0) 예측하는 **분류(Classification)** 모델을 만드는 것입니다. AutoML은 이 데이터를 사용하여 다양한 알고리즘과 하이퍼파라미터를 자동으로 시도하여 `Diabetic` 열을 가장 잘 예측하는 모델을 찾습니다.

좋습니다. AutoML 학습 작업이 완료되면 Azure Machine Learning 스튜디오에서 그 결과를 자세히 살펴볼 수 있습니다.

---

### 완료된 AutoML 작업 결과 탐색

AutoML 작업이 성공적으로 "완료됨(Completed)" 상태가 되면, 해당 작업 페이지에서 다양한 정보를 확인할 수 있습니다.

1.  **작업 세부 정보 페이지 유지**: AutoML 작업이 완료되면 해당 작업의 세부 정보 페이지에 머무릅니다. 만약 다른 페이지로 이동했다면, 왼쪽 메뉴의 **작업(Jobs)** 을 선택하고, 실험 이름 (기본값 또는 사용자가 지정한 이름) 아래에서 방금 실행한 AutoML 작업을 클릭하여 다시 열 수 있습니다.

2.  **모델(Models) 탭 확인**:
    *   작업 세부 정보 페이지 상단에 있는 **모델(Models)** 탭을 선택합니다.
    *   여기에는 AutoML이 학습하고 평가한 모든 모델의 목록이 표시됩니다. 각 모델은 다른 알고리즘 또는 전처리 단계를 나타낼 수 있습니다.
    *   목록은 기본적으로 우리가 설정한 **기본 메트릭(Primary metric)** (이 경우 **정확도(Accuracy)**)을 기준으로 정렬되어 있어, 가장 성능이 좋은 모델이 맨 위에 표시됩니다.
    *   각 모델에 대해 다양한 메트릭 값(예: AUC\_weighted, Precision\_score\_weighted 등)을 확인할 수 있습니다.

3.  **최상의 모델 요약(Best model summary) 확인**:
    *   **모델(Models)** 탭 목록에서 가장 위에 있는 모델 (알고리즘 이름이 표시된 링크)을 클릭합니다. 이것이 AutoML이 식별한 최상의 모델입니다.
    *   새로운 탭이나 섹션이 열리면서 선택한 모델에 대한 더 자세한 정보가 표시됩니다.
    *   **요약(Summary)**: 선택된 알고리즘 이름, 모델 상태, 생성 시간 등을 보여줍니다.
    *   **설명(Explanations) (미리 보기)**: 모델이 예측을 내리는 방식에 대한 통찰력을 제공합니다. 어떤 특징(feature)이 예측에 가장 큰 영향을 미치는지 등을 확인할 수 있습니다 (이 기능은 별도의 계산이 필요할 수 있으며, 이번 실습의 주 내용은 아닙니다).
    *   **메트릭(Metrics)**: 이 특정 모델에 대한 다양한 성능 메트릭과 시각화(예: 혼동 행렬, ROC 곡선, 정밀도-재현율 곡선 등)를 자세히 볼 수 있습니다.
        *   **혼동 행렬(Confusion matrix)**: 모델이 각 클래스(당뇨병/비당뇨병)를 얼마나 잘 예측했는지 보여줍니다. (TP, FP, TN, FN 값)
        *   **ROC 곡선(ROC curve)**: 다양한 임계값에서 모델의 성능(True Positive Rate vs False Positive Rate)을 시각화합니다. 곡선 아래 면적(AUC)이 클수록 좋습니다.

4.  **데이터 보호(Data guardrails) 탭 (선택 사항)**:
    *   최상의 모델 세부 정보 페이지에서 **데이터 보호(Data guardrails)** 탭을 살펴보세요.
    *   AutoML이 데이터에 대해 수행한 자동 전처리 단계(예: 결측치 처리, 클래스 불균형 감지, 고유 카디널리티 특성 감지 등)에 대한 정보를 제공합니다. 이를 통해 데이터 품질 문제에 대한 통찰을 얻을 수 있습니다.

5.  **출력 + 로그(Outputs + logs) 탭 확인**:
    *   AutoML 작업의 기본 페이지 또는 개별 모델 실행 페이지에서 **출력 + 로그(Outputs + logs)** 탭을 선택합니다.
    *   여기에는 AutoML 실행 중에 생성된 다양한 로그 파일과 아티팩트가 포함됩니다.
        *   `driver/stdout.txt`: AutoML 프로세스의 주 실행 로그입니다.
        *   생성된 모델 파일(`model.pkl`), 전처리 단계 파일 등도 이곳에서 찾을 수 있습니다. 문제 해결이나 심층 분석에 유용합니다.

---

** 실습 요약 **

이 실습을 통해 다음을 수행했습니다.

*   Azure Portal을 사용하여 Azure Machine Learning 작업 영역 및 관련 리소스를 프로비저닝했습니다.
*   Azure Machine Learning 스튜디오의 주요 구성 요소를 탐색하고, 자산(데이터, 작업, 모델)과 관리(컴퓨팅)의 개념을 이해했습니다.
*   로컬 데이터를 Azure ML 데이터 자산으로 업로드했습니다.
*   AutoML을 사용하여 코딩 없이 당뇨병 예측을 위한 분류 모델을 학습시켰습니다.
*   AutoML 작업 결과를 검토하고, 시도된 여러 모델 중 최상의 모델과 그 성능 메트릭을 확인했습니다.
*   작업(Jobs) 기록을 통해 실험 과정을 추적하고 검토하는 방법을 이해했습니다.

